---
title: DDD
description: DDD-领域驱动设计
#top: 1
date: 2020-10-09 16:51:54
tags:
- DDD
categories:
- 架构
---


### 方法论
```text
六边形架构、洋葱架构、整洁架构、四色原型

SIDE-EFFECT-FREE模式被称为无副作用模式，熟悉函数时编程的朋友都知道，严格的函数就是一个无副作用的函数，对于一个给定的输入，总是返回固定的结果，通常查询功能就是一个函数，命令功能就不是一个函数，它通常会执行某些修改。

在DDD架构中，通常会将查询和命令操作分开，我们称之为CQRS(命令查询的责任分离Command Query Responsibility Segregation)，具体落地时，是否将Command和Query分开成两个项目可以看情况决定，大多数情况下放在一个项目可以提高业务内聚性，
```

#### 六边形架构
- [起源文章](http://alistair.cockburn.us/Hexagonal+architecture)
- [相关文章&demo](https://www.jianshu.com/p/c6bb08d9c613)
- 摘要
```text
六角架构的初衷是：
允许应用程序同样由用户，程序，自动化测试或批处理脚本驱动，并与最终的运行时设备和数据库隔离开发和测试。

```


#### 洋葱架构
- [在洋葱(Onion)架构中实现领域驱动设计](https://www.infoq.cn/article/2014/11/ddd-onion-architecture)
- 摘要
```text
Core ) Domain ) API ) Infrastructure )

洋葱架构中的一个重要概念是依赖，外部的层能够访问内部的层，而内部的层则对外部的层一无所知。

核心（Core）层是与领域或技术无关的基础构件块，它包含了一些通用的构件块,包含任何技术层面的概念
领域（Domain）层是定义业务逻辑的地方，每个类的方法都是按照领域通用语言中的概念进行命名的
API 层是领域层的入口，它使用领域中的术语和对象。
基础架构（Infrastructure）层是最外部的一层，它包含了对接各种技术的适配器，例如数据库、用户界面以及外部服务。
```

#### 整洁架构
- [阿里云-架构整洁之道](https://www.jianshu.com/p/b296ceea673b)


#### 四色原型-需求分析利器

- 解释
|四色英文简介|四色中文简介|颜色|四色描述|举例|
|---|---|---|---|
|PPT|事物|淡绿色|人、部门、地点、物品等|用户、基础组织、产品|
|DESC|描述/分类|淡蓝色|对于PPT的分类描述|用户类型、产品分类|
|ROLE|角色|淡蓝色|PPT按业务场景的细分角色|买方、卖方、财务组织、采购组织|
|MI/MIDetail|事件|淡红色|ROLE在某段时所发生的事件。MI指事件；MIDetail:事件的明细|订单、订单明细|

- 备注
```text
“四色原型”是在使用UML建模的时候，把实体分为四类，并标注不同的颜色的一种建模方法。
用一句话来概括四色原型就是：一个什么样的人或物品以某种角色在某个时刻或某段时间内参与某个活动。其中“什么样的”就是DESC，“人或物品”就是PPT,”角色”就是ROLE,而“某个时刻或某个时间段内的某个活动”就是MI。
四色原型”有一个规则：就是MI（事件）不能与PPT（事物）直接打交道，必须通过ROLE（角色）来打交道。例如：只有买家才能下订单，订单只能通过买家与用户关联
```


### DDD核心概念
- 实体
- 值对象
- 聚合
- 仓储

```text
结合四色原型图，设计领域模型的步骤可概括为以下几步：
1.根据需求，采用四色原型分析法建立一个初步的领域模型；
2.进一步分析领域模型，识别出哪些是实体，哪些是值对象，哪些是领域服务；
3.对实体、值对象进行关联和聚合，提炼出聚合边界和聚合根；
4.为聚合根设计仓储（一般情况下，一个聚合分配一个仓储），同时，思考实体、值对象的创建方式，是通过工厂创建，还是直接通过构造函数；
5.走查需求场景，验证设计的领域模型的合理性。
```
